<h3 align="center">
<img alt="dev" width="400px" src="./.github/undraw_programmer_imem.svg" />
</h3>
<h3 align="center">
  M√≥dulo de Usu√°rio
</h3>

## üöÄ Sobre

M√≥dulo de usu√°rio com algumas funcionalidades prontas, tais como:

- Cadastro;
- Login;
- Atualiza√ß√£o de perfil;
- Envio de email para reset de senha;
- Reset de senha;
- Upload de imagem (avatar do usu√°rio);
- Envio de notifica√ß√µes;
- Cache

Todo desenvolvido visando a f√°cil manuten√ß√£o, boas pr√°ticas e facilidade em caso de troca de alguma das tecnologias.

Segue os principios do SOLID e DDD.

Funcionalidades testadas.

## üíª Tecnologias e libs

- NodeJS - (Interpretador de JavaScript)
- ExpressJS - (Framework NodeJS)
- TypeScript - (Adiciona tipagem e alguns outros recursos ao JS)
- Eslint - (Ferramenta de an√°lise de c√≥digo)
- Prettier - (Code Formatter)
- Jest - (Estrutura de teste de JavaScript)
- Nodemailer - (Lib para envio de e-mails)
- Ethereal - (Servi√ßo SMTP fake)
- Mailtrap - (Servi√ßo SMTP fake)
- SES - (Servi√ßo de envio de email - AWS)
- Multer - (Lib para upload de arquivos)
- Tsyringe - (Lib para inje√ß√£o de depend√™ncias)
- Postgres - (Banco de dados relacional)
- TypeORM - (ORM)
- Json Web Token (t√©cnica para autentica√ß√£o)
- MongoDB - (Banco de dados n√£o relacional)
- Redis - (Banco de dados chave-valor)
- S3 - (Servi√ßo de armazenamento - AWS)
- Celebrate - (Middleware de valida√ß√£o)
- ...

\* Servi√ßos pagos da AWS, apenas para sistema em produ√ß√£o.

## üöÄ Instala√ß√£o e execu√ß√£o

1. Fa√ßa um clone desse reposit√≥rio;
2. Entre na pasta do projeto pelo terminal;
3. Rode `yarn` para instalar as depend√™ncias;
4. Crie um arquivo **.env** (use **.env.example** como modelo) e modifique o valor das vari√°veis;
5. Rode `yarn dev:server` para iniciar o servidor de desenvolvimento;

### ‚öô Configura√ß√£o do banco de dados

1. Crie uma base de dados do Postgres;
2. No arquivo **ormconfig.json** modifique as credenciais (host, database, user, password);
3. Rode `yarn typeorm migration:run` para rodas as migrations;

### üìß Configura√ß√£o para envio de email

1. No arquivo .env, escolha o provider de email (ethereal, mailtrap ou ses).
   Ex: MAIL_DRIVER=ethereal;
2. Se necess√°rio, descomente e/ou altere as credenciais;

### üîî Configura√ß√µes para envio de notifica√ß√µes

1. Crie uma base de dados do MongoDB
2. No arquivo **ormconfig.json** modifique o nome database e host, se necess√°rio.

#### Exemplo de c√≥digo para envio de notifica√ß√µes

Adiciona em uma classe atrav√©s de inje√ß√£o de depend√™ncia

```ts
constructor(
    @inject('NotificationsRepository')
    private notificationsRepository: INotificationsRepository,
  ) {}
```

Envia a notifica√ß√£o passando os dados necess√°rios.

```ts
await this.notificationsRepository.create({
  recipient_id,
  content: `Conte√∫do da notifica√ß√£o`,
});
```

OBS: Os dados enviados podem v√°riar, basta modificar no modulo de notifications (Schema, Repository, etc).

### ‚öô Configura√ß√£o para salvar cache

1. Rodar o Redis;
2. Alterar as credenciais no arquivo .env (REDIS_HOST, REDIS_POST, REDIS_PASS);

#### Exemplo de c√≥digo para salvar cache

Adiciona em uma classe atrav√©s de inje√ß√£o de depend√™ncia

```ts
constructor(
    @inject('CacheProvider')
    private cacheProvider: ICacheProvider,
  ) {}
```

Salva algum valor em cache:

```ts
await this.cacheProvider.save(`nome-da-key`, value);
```

Deleta/Invalida o cache:

```ts
await this.cacheProvider.invalidate('nome-da-key');
await this.cacheProvider.invalidatePrefix('nome-da-key:');
```

Recupera os dados:

```ts
let users = await this.cacheProvider.recover<User[]>(`nome-da-key`);
```

### üß™ Testes

1. Rode `yarn test` para executar os testes;
